<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Gestione Utente</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-image: url("{{ url_for('static', filename='img/sfondo.png') }}");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: center center;
      font-family: 'Segoe UI', sans-serif;
    }
    .container {
      max-width: 900px;
      margin-top: 10px;
      padding: 0px 30px 30px 30px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      text-align: center;
    }
    .section {
      margin-bottom: 30px;
    }
    h1 {
      text-align: center;
      color: #003366;
      font-size: 2.8rem;
      margin-bottom: 15px;
    }
    h2 {
      text-align: center;
      color: #003366;
      font-size: 1.5rem;
      margin-bottom: 15px;
    }
    .list-group-item {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Logo sinistra, titolo, logo destra -->
    <div class="d-flex justify-content-between align-items-center mb-3 pt-2">
      <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo sinistra" style="max-height: 60px;">
      <h1 class="flex-grow-1 m-0" style="font-size: 1.8rem;">Gestione Utente</h1>
      <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo destra" style="max-height: 60px;">
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Cambio Password -->
    <div class="section">
      <h2>ğŸ”’ Cambio Password</h2>
      <form method="POST" action="{{ url_for('change_password') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="mb-3">
          <input type="password" name="old_password" class="form-control" placeholder="Vecchia Password" required>
        </div>
        <div class="mb-3">
          <input type="password" name="new_password" class="form-control" placeholder="Nuova Password" required>
        </div>
        <button type="submit" class="btn btn-primary">Aggiorna</button>
      </form>
    </div>

    <!-- Segnalazioni -->
    <div class="section">
      <h2>ğŸ§  Segnala un Problema o Suggerimento</h2>
      <form method="POST" action="{{ url_for('gestione_utente') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <textarea name="message" class="form-control" rows="4" placeholder="Descrivi il problema o il suggerimento..." required></textarea>
        <button type="submit" class="btn btn-secondary mt-2">Invia</button>
      </form>
    </div>

    <!-- Riepilogo Autorizzazioni -->
    <div class="section">
      <h2>ğŸ“‹ Riepilogo Autorizzazioni</h2>
      <ul class="list-group">
        <li class="list-group-item">ğŸ‘¤ Utente: {{ user.username }}</li>
        <li class="list-group-item">ğŸ“§ Email: {{ user.email }}</li>
        <li class="list-group-item">ğŸ¢ Azienda: {{ user.company.name }}</li>
        <li class="list-group-item">ğŸ·ï¸ Reparto: {{ user.department.name }}</li>
        <li class="list-group-item">ğŸ›¡ï¸ Ruolo: {{ user.role|capitalize }}</li>
      </ul>
    </div>

    <!-- Carica Foto Profilo -->
    <div class="section">
      <h2>ğŸ–¼ï¸ Carica Foto Profilo</h2>
      <form method="POST" action="{{ url_for('upload_profile_picture') }}" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="file" name="profile_picture" accept="image/*" class="form-control mb-2" required>
        <button type="submit" class="btn btn-success">Carica</button>
      </form>

      {% if user.profile_picture %}
        <div class="mt-3">
          <img src="{{ url_for('static', filename='profile_pics/' ~ user.profile_picture) }}"
               alt="Foto Profilo"
               style="max-height: 150px; border-radius: 50%;">
        </div>
      {% endif %}
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
