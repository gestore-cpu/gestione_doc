{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>üìÅ Storico richieste di accesso</h2>
  <table class="table table-striped table-bordered mt-3">
    <thead>
      <tr>
        <th>Data</th>
        <th>File</th>
        <th>Azienda</th>
        <th>Reparto</th>
        <th>Motivazione</th>
        <th>Stato</th>
        <th>Risposta</th>
      </tr>
    </thead>
    <tbody>
      {% for r in requests %}
      <tr>
        <td>{{ r.created_at.strftime('%d/%m/%Y') }}</td>
        <td><strong>{{ r.document.title or r.document.original_filename }}</strong></td>
        <td>{{ r.document.company.name if r.document.company else 'N/A' }}</td>
        <td>{{ r.document.department.name if r.document.department else 'N/A' }}</td>
        <td>{{ r.note or 'Nessuna motivazione' }}</td>
        <td>
          {% if r.status == 'pending' %}
            <span class="badge bg-warning text-dark">In attesa</span>
          {% elif r.status == 'approved' %}
            <span class="badge bg-success">Approvata</span>
          {% elif r.status == 'denied' %}
            <span class="badge bg-danger">Negata</span>
          {% endif %}
        </td>
        <td>
          {% if r.risposta_ai %}
            <span data-bs-toggle="tooltip" title="{{ r.risposta_ai }}">üí¨</span>
          {% else %}
            ‚Äî
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  
  {% if not requests %}
  <div class="text-center py-5">
    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">Nessuna richiesta di accesso presente</h4>
    <p class="text-muted">Non hai ancora inviato richieste di accesso ai documenti.</p>
  </div>
  {% endif %}
</div>

<script>
  // Inizializza tooltip Bootstrap
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })
</script>
{% endblock %} 